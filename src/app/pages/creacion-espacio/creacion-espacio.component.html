<div class="container">
    <div class="row">
        <div class="col-md-12">
            <form [formGroup]="form" (ngSubmit) = "submit()">

                <div class="row">
                    <div class="col-md-5">

                        <div class="form-group">
                            <label>Universidad</label>
                            <select class="form-control" formControlName="universidad" [ngClass]="{'is-invalid': form.get('universidad').touched && form.get('universidad').invalid}">
                                <option value="">------</option>
                                <option *ngFor="let valor of universidades" [value]="valor.nombre">{{valor.nombre}}</option>
                            </select>
                            <div class="alert alert-danger" *ngIf="form.get('universidad').touched && form.get('universidad').hasError('required')">
                                Debes introducir una universidad
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Facultades</label>
                            <select class="form-control" formControlName="facultades" [ngClass]="{'is-invalid': form.get('facultades').touched && form.get('facultades').invalid}">
                                <option value="">------</option>
                                <option *ngFor="let valor of facultades" [value]="valor.nombre">{{valor.nombre}}</option>
                            </select>
                            <div class="alert alert-danger" *ngIf="form.get('facultades').touched && form.get('facultades').hasError('required')">
                                Debes introducir una facultad
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Grado</label>
                            <select class="form-control" formControlName="grado" [ngClass]="{'is-invalid': form.get('grado').touched && form.get('grado').invalid}">
                                <option value="">------</option>
                                <option *ngFor="let valor of grados" [value]="valor.nombre">{{valor.nombre}}</option>
                            </select>
                            <div class="alert alert-danger" *ngIf="form.get('grado').touched && form.get('grado').hasError('required')">
                                Debes introducir un grado
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Curso</label>
                            <select class="form-control" formControlName="curso" [ngClass]="{'is-invalid': form.get('curso').touched && form.get('curso').invalid}">
                                <option value="">------</option>
                                <option *ngFor="let valor of cursos" [value]="valor.nombre">{{valor.nombre}}</option>
                            </select>
                            <div class="alert alert-danger" *ngIf="form.get('curso').touched && form.get('curso').hasError('required')">
                                Debes introducir un curso
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Asignatura</label>
                            <select class="form-control" formControlName="asignatura" [ngClass]="{'is-invalid': form.get('asignatura').touched && form.get('asignatura').invalid}">
                                <option value="">------</option>
                                <option *ngFor="let valor of asignaturas" [value]="valor.id">{{valor.nombre}}</option>
                            </select>
                            <div class="alert alert-danger" *ngIf="form.get('asignatura').touched && form.get('asignatura').hasError('required')">
                                Debes introducir una asignatura
                            </div>
                        </div>
        
                        <div class="form-group">
                            <label>Precio</label>
                            <input matInput type="text" name="precio" formControlName="precio" 
                            placeholder="Introduce el precio por hora..." class="form-control" [ngClass]="{'is-invalid': form.get('precio').touched && form.get('precio').invalid}">
                            <div class="alert alert-danger" *ngIf="form.get('precio').touched && form.get('precio').hasError('required')">
                                El precio es requerido
                            </div>
                            <div class="alert alert-danger" *ngIf="form.get('precio').touched && form.get('precio').hasError('min')">
                                El precio debe ser mayor que 0
                            </div>
                            <div class="alert alert-danger" *ngIf="form.get('precio').touched && form.get('precio').hasError('pattern')">
                                Introduce un precio válido
                            </div>
                        </div>

                        
                    </div>

                    <div class="col-md-5" >
                        HORARIO
                        <hr>
                        <div formArrayName="horarios" *ngFor="let hor of form.get('horarios')?.controls; let i=index;">
                            <div class="row" [formGroupName]="i">

                                <div class="form-group col-md-3">
                                    <label>Día</label>
                                    <select class="form-control" formControlName="dia" [ngClass]="{'is-invalid': form.get('horarios')?.controls[i].get('dia').touched && form.get('horarios')?.controls[i].get('dia').invalid}">
                                        <option value="">------</option>
                                        <option *ngFor="let dia of diasSemana" [value]="dia">{{dia}}</option>
                                    </select>
                                    
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Hora inicio</label>
                                        <input type="text" formControlName="fechaInicio" class="form-control" 
                                        name="fechaInicio" placeholder="HH:mm" [ngClass]="{'is-invalid': form.get('horarios')?.controls[i].get('fechaInicio').touched && form.get('horarios')?.controls[i].get('fechaInicio').invalid}">
                                        
                                    </div>
                                </div>


                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Hora fin</label>
                                        <input type="text" formControlName="fechaFin" class="form-control" 
                                        name="fechaFin" placeholder="HH:mm" [ngClass]="{'is-invalid': form.get('horarios')?.controls[i].get('fechaFin').touched && form.get('horarios')?.controls[i].get('fechaFin').invalid}">
                                        
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label>Capacidad</label>
                                        <input matInput type="text" name="capacidad" formControlName="capacidad" 
                                        class="form-control" [ngClass]="{'is-invalid': form.get('horarios')?.controls[i].get('capacidad').touched && form.get('horarios')?.controls[i].get('capacidad').invalid}">
                                        
                                    </div>
                                </div>

                                <div class="col-md-12 ml-3">
                                    <!--VALIDACION REQUIRED-->
                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].get('dia').touched && form.get('horarios')?.controls[i].get('dia').hasError('required')">
                                        El día es requerido
                                    </div>

                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].get('fechaInicio').touched && form.get('horarios')?.controls[i].get('fechaInicio').hasError('required')">
                                        La fecha de inicio es requerida
                                    </div>

                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].get('fechaFin').touched && form.get('horarios')?.controls[i].get('fechaFin').hasError('required')">
                                        La fecha de fin es requerida
                                    </div>

                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].get('capacidad').touched && form.get('horarios')?.controls[i].get('capacidad').hasError('required')">
                                        La capacidad es requerida
                                    </div>

                                    <!--VALIDACION PATTERN-->
                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].get('fechaInicio').touched && form.get('horarios')?.controls[i].get('fechaInicio').hasError('pattern')">
                                        Introduce una hora de inicio valida
                                    </div>
                                    
                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].get('fechaFin').touched && form.get('horarios')?.controls[i].get('fechaFin').hasError('pattern')">
                                        Introduce una hora de fin valida
                                    </div>

                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].get('capacidad').touched && form.get('horarios')?.controls[i].get('capacidad').hasError('pattern')">
                                        Introduce una capacidad válida
                                    </div>

                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].get('capacidad').touched && form.get('horarios')?.controls[i].get('capacidad').hasError('min')">
                                        La capacidad debe ser mayor que 0
                                    </div>

                                    <!--VALIDACION HORA INICIO < HORA FIN-->
                                    <div class="alert alert-danger" *ngIf="form.get('horarios')?.controls[i].touched && form.get('horarios')?.controls[i].hasError('noValidHour')">
                                        La fecha de fin debe ser mayor que la fecha de inicio
                                    </div>
                                </div>

                            </div>
                            <div *ngIf="i != 0">
                            <button type="button" title="Eliminar horario" (click)="deleteHorario(i)"><i class="fas fa-trash-alt"></i></button>
                            </div>

                        </div>
                        <button type="button" title="Añadir horario" (click)="addNuevoHorario()"><i class="fas fa-plus"></i></button>
                    </div>
                </div>

                <button class="btn btn-primary btn-block col-md-6 mx-auto d-block" [disabled]="form.invalid">
                    Guardar
                </button>



            </form>
        </div>
    </div>
</div>
